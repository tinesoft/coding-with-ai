<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 500">
  <defs>
    <style>
      .text { font-family: Arial, sans-serif; font-size: 13px; fill: #333; }
      .title { font-size: 20px; font-weight: bold; fill: #1e3a8a; }
      .component { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; }
      .test { fill: #d1fae5; stroke: #10b981; stroke-width: 2; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-flow { stroke: #3b82f6; stroke-width: 2; stroke-dasharray: 5,5; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <text x="350" y="35" class="title" text-anchor="middle">Integration Test Example: Multi-Component Flow</text>
  
  <!-- API Layer -->
  <rect x="50" y="80" width="160" height="80" class="component" rx="5"/>
  <text x="130" y="110" class="text" text-anchor="middle" font-weight="bold">API Layer</text>
  <text x="130" y="130" class="text" text-anchor="middle" font-size="11">/api/users</text>
  <text x="130" y="145" class="text" text-anchor="middle" font-size="11">POST /create</text>
  
  <!-- Service Layer -->
  <rect x="270" y="80" width="160" height="80" class="component" rx="5"/>
  <text x="350" y="110" class="text" text-anchor="middle" font-weight="bold">Service Layer</text>
  <text x="350" y="130" class="text" text-anchor="middle" font-size="11">UserService</text>
  <text x="350" y="145" class="text" text-anchor="middle" font-size="11">.createUser()</text>
  
  <!-- Data Layer -->
  <rect x="490" y="80" width="160" height="80" class="component" rx="5"/>
  <text x="570" y="110" class="text" text-anchor="middle" font-weight="bold">Data Layer</text>
  <text x="570" y="130" class="text" text-anchor="middle" font-size="11">Database</text>
  <text x="570" y="145" class="text" text-anchor="middle" font-size="11">INSERT query</text>
  
  <!-- Data Flow Arrows -->
  <path d="M 210 120 L 270 120" class="arrow"/>
  <text x="240" y="110" class="text" font-size="10">request</text>
  
  <path d="M 430 120 L 490 120" class="arrow"/>
  <text x="460" y="110" class="text" font-size="10">save</text>
  
  <!-- Integration Test -->
  <rect x="150" y="250" width="400" height="120" class="test" rx="8"/>
  <text x="350" y="280" class="text" text-anchor="middle" font-weight="bold" fill="#047857">Integration Test Scope</text>
  <text x="350" y="305" class="text" text-anchor="middle" font-size="11">
    Tests the ENTIRE flow from API → Service → Database
  </text>
  <text x="350" y="325" class="text" text-anchor="middle" font-size="11">
    Validates: Data transformation, business logic, persistence
  </text>
  <text x="350" y="345" class="text" text-anchor="middle" font-size="11" font-weight="bold">
    AI Prompt: "Generate integration test for user creation endpoint"
  </text>
  
  <!-- Connection arrows from test to components -->
  <path d="M 220 250 L 130 160" class="data-flow"/>
  <path d="M 350 250 L 350 160" class="data-flow"/>
  <path d="M 480 250 L 570 160" class="data-flow"/>
  
  <!-- Example Code Box -->
  <rect x="50" y="400" width="600" height="80" fill="#f9fafb" stroke="#d1d5db" stroke-width="1" rx="5"/>
  <text x="350" y="425" class="text" text-anchor="middle" font-family="'Courier New', monospace" font-size="10">
    describe('User Creation Flow', () => {
  </text>
  <text x="350" y="442" class="text" text-anchor="middle" font-family="'Courier New', monospace" font-size="10">
      it('should create user and persist to database', async () => {
  </text>
  <text x="350" y="459" class="text" text-anchor="middle" font-family="'Courier New', monospace" font-size="10">
        const response = await request(app).post('/api/users').send(userData);
  </text>
  <text x="350" y="476" class="text" text-anchor="middle" font-family="'Courier New', monospace" font-size="10">
        expect(await db.users.findOne({ email: userData.email })).toBeDefined();
  </text>
</svg>
